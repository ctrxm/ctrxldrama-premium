(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55838,(e,t,a)=>{"use strict";var s=e.r(71645),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=s.useState,i=s.useEffect,o=s.useLayoutEffect,l=s.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!r(e,a)}catch(e){return!0}}var d="u"<typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),s=n({inst:{value:a,getSnapshot:t}}),r=s[0].inst,d=s[1];return o(function(){r.value=a,r.getSnapshot=t,c(r)&&d({inst:r})},[e,a,t]),i(function(){return c(r)&&d({inst:r}),e(function(){c(r)&&d({inst:r})})},[e]),l(a),a};a.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:d},2239,(e,t,a)=>{"use strict";t.exports=e.r(55838)},77572,105,89143,57974,81464,26120,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(81140),r=e.i(30030),n=e.i(42727),i=e.i(96626),o=e.i(48425),l=e.i(86318),c=e.i(69340),d=e.i(10772),u="Tabs",[m,f]=(0,r.createContextScope)(u,[n.createRovingFocusGroupScope]),p=(0,n.createRovingFocusGroupScope)(),[h,x]=m(u),g=a.forwardRef((e,a)=>{let{__scopeTabs:s,value:r,onValueChange:n,defaultValue:i,orientation:m="horizontal",dir:f,activationMode:p="automatic",...x}=e,g=(0,l.useDirection)(f),[y,v]=(0,c.useControllableState)({prop:r,onChange:n,defaultProp:i??"",caller:u});return(0,t.jsx)(h,{scope:s,baseId:(0,d.useId)(),value:y,onValueChange:v,orientation:m,dir:g,activationMode:p,children:(0,t.jsx)(o.Primitive.div,{dir:g,"data-orientation":m,...x,ref:a})})});g.displayName=u;var y="TabsList",v=a.forwardRef((e,a)=>{let{__scopeTabs:s,loop:r=!0,...i}=e,l=x(y,s),c=p(s);return(0,t.jsx)(n.Root,{asChild:!0,...c,orientation:l.orientation,dir:l.dir,loop:r,children:(0,t.jsx)(o.Primitive.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:a})})});v.displayName=y;var w="TabsTrigger",b=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:i,disabled:l=!1,...c}=e,d=x(w,r),u=p(r),m=k(d.baseId,i),f=S(d.baseId,i),h=i===d.value;return(0,t.jsx)(n.Item,{asChild:!0,...u,focusable:!l,active:h,children:(0,t.jsx)(o.Primitive.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":f,"data-state":h?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:m,...c,ref:a,onMouseDown:(0,s.composeEventHandlers)(e.onMouseDown,e=>{l||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(i)}),onKeyDown:(0,s.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(i)}),onFocus:(0,s.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==d.activationMode;h||l||!e||d.onValueChange(i)})})})});b.displayName=w;var j="TabsContent",N=a.forwardRef((e,s)=>{let{__scopeTabs:r,value:n,forceMount:l,children:c,...d}=e,u=x(j,r),m=k(u.baseId,n),f=S(u.baseId,n),p=n===u.value,h=a.useRef(p);return a.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(i.Presence,{present:l||p,children:({present:a})=>(0,t.jsx)(o.Primitive.div,{"data-state":p?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!a,id:f,tabIndex:0,...d,ref:s,style:{...e.style,animationDuration:h.current?"0s":void 0},children:a&&c})})});function k(e,t){return`${e}-trigger-${t}`}function S(e,t){return`${e}-content-${t}`}N.displayName=j;var C=e.i(75157);let _=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(v,{ref:s,className:(0,C.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));_.displayName=v.displayName;let M=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(b,{ref:s,className:(0,C.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...a}));M.displayName=b.displayName;let q=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(N,{ref:s,className:(0,C.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a}));q.displayName=N.displayName,e.s(["Tabs",()=>g,"TabsContent",()=>q,"TabsList",()=>_,"TabsTrigger",()=>M],77572);var R=e.i(75254);let E=(0,R.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),L=(0,R.default)("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]),T=(0,R.default)("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]),I=(0,R.default)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),D=(0,R.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var K=e.i(55146),F=e.i(19455),$=e.i(46696);function A({title:e,url:a,description:s,variant:r="icon",className:n}){let i=a||window.location.href,o=`${e}${s?` - ${s}`:""}`,l=async()=>{try{await navigator.clipboard.writeText(i),$.toast.success("Link disalin ke clipboard")}catch{$.toast.error("Gagal menyalin link")}},c="icon"===r?(0,t.jsx)("button",{className:(0,C.cn)("p-2 rounded-full bg-black/50 hover:bg-black/70 transition-colors",n),children:(0,t.jsx)(E,{className:"w-5 h-5 text-white"})}):(0,t.jsxs)(F.Button,{variant:"outline",className:n,children:[(0,t.jsx)(E,{className:"w-4 h-4 mr-2"}),"Bagikan"]});return(0,t.jsxs)(K.DropdownMenu,{children:[(0,t.jsx)(K.DropdownMenuTrigger,{asChild:!0,children:c}),(0,t.jsxs)(K.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(K.DropdownMenuItem,{onClick:l,children:[(0,t.jsx)(D,{className:"w-4 h-4 mr-2"}),"Salin Link"]}),(0,t.jsxs)(K.DropdownMenuItem,{onClick:()=>{window.open(`https://wa.me/?text=${encodeURIComponent(`${o}
${i}`)}`,"_blank")},children:[(0,t.jsx)(I,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),(0,t.jsxs)(K.DropdownMenuItem,{onClick:()=>{window.open(`https://t.me/share/url?url=${encodeURIComponent(i)}&text=${encodeURIComponent(o)}`,"_blank")},children:[(0,t.jsx)(I,{className:"w-4 h-4 mr-2"}),"Telegram"]}),(0,t.jsxs)(K.DropdownMenuItem,{onClick:()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`,"_blank","width=600,height=400")},children:[(0,t.jsx)(L,{className:"w-4 h-4 mr-2"}),"Facebook"]}),(0,t.jsxs)(K.DropdownMenuItem,{onClick:()=>{window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&url=${encodeURIComponent(i)}`,"_blank","width=600,height=400")},children:[(0,t.jsx)(T,{className:"w-4 h-4 mr-2"}),"Twitter / X"]})]})]})}e.s(["ShareButton",()=>A],105);var P=e.i(45423);let B=(0,R.default)("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var U=e.i(8703),Q=e.i(57951);function G({drama_id:e,platform:a,drama_title:s,variant:r="icon",className:n}){let{user:i}=(0,Q.useAuth)(),{isSubscribed:o,subscribe:l,unsubscribe:c}=(0,U.useNotifications)(),d=o(e,a),u=t=>{(t.preventDefault(),t.stopPropagation(),i)?d?c({drama_id:e,platform:a},{onSuccess:()=>$.toast.success("Notifikasi dimatikan"),onError:()=>$.toast.error("Gagal mematikan notifikasi")}):l({drama_id:e,platform:a,drama_title:s},{onSuccess:()=>$.toast.success("Akan diberitahu episode baru"),onError:()=>$.toast.error("Gagal mengaktifkan notifikasi")}):$.toast.error("Silakan login terlebih dahulu")};return"icon"===r?(0,t.jsx)("button",{onClick:u,className:(0,C.cn)("p-2 rounded-full bg-black/50 hover:bg-black/70 transition-colors",n),title:d?"Matikan notifikasi":"Nyalakan notifikasi",children:d?(0,t.jsx)(B,{className:"w-5 h-5 text-yellow-400"}):(0,t.jsx)(P.Bell,{className:"w-5 h-5 text-white"})}):(0,t.jsx)(F.Button,{onClick:u,variant:d?"default":"outline",className:n,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B,{className:"w-4 h-4 mr-2"}),"Matikan Notifikasi"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.Bell,{className:"w-4 h-4 mr-2"}),"Notifikasi Episode Baru"]})})}e.s(["SubscribeButton",()=>G],89143);var H=e.i(70273);let z=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("textarea",{className:(0,C.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));z.displayName="Textarea";var O=e.i(66027),V=e.i(54616),J=e.i(12598),W=e.i(7471);function Z(e,t){let{user:a}=(0,Q.useAuth)(),s=(0,J.useQueryClient)(),r=(0,O.useQuery)({queryKey:["ratings",e,t],queryFn:async()=>{if(!e||!t)return[];let{data:a,error:s}=await W.supabase.from("ratings").select("*").eq("drama_id",e).eq("platform",t).order("created_at",{ascending:!1});if(s)throw s;return a},enabled:!!e&&!!t}),n=(0,O.useQuery)({queryKey:["user_rating",a?.id,e,t],queryFn:async()=>{if(!a||!e||!t)return null;let{data:s,error:r}=await W.supabase.from("ratings").select("*").eq("user_id",a.id).eq("drama_id",e).eq("platform",t).single();if(r&&"PGRST116"!==r.code)throw r;return s},enabled:!!a&&!!e&&!!t}),i=(0,V.useMutation)({mutationFn:async s=>{if(!a||!e||!t)throw Error("Missing required data");let{error:r}=await W.supabase.from("ratings").upsert({user_id:a.id,drama_id:e,platform:t,rating:s.rating,review:s.review},{onConflict:"user_id,drama_id,platform"});if(r)throw r},onSuccess:()=>{s.invalidateQueries({queryKey:["ratings",e,t]}),s.invalidateQueries({queryKey:["user_rating",a?.id,e,t]}),s.invalidateQueries({queryKey:["drama_stats"]})}}),o=(0,V.useMutation)({mutationFn:async()=>{if(!a||!e||!t)throw Error("Missing required data");let{error:s}=await W.supabase.from("ratings").delete().eq("user_id",a.id).eq("drama_id",e).eq("platform",t);if(s)throw s},onSuccess:()=>{s.invalidateQueries({queryKey:["ratings",e,t]}),s.invalidateQueries({queryKey:["user_rating",a?.id,e,t]}),s.invalidateQueries({queryKey:["drama_stats"]})}}),l=r.data?.length?r.data.reduce((e,t)=>e+t.rating,0)/r.data.length:0;return{ratings:r.data??[],userRating:n.data,averageRating:l,totalRatings:r.data?.length??0,isLoading:r.isLoading,submitRating:i.mutate,deleteRating:o.mutate,isSubmitting:i.isPending}}function X({drama_id:e,platform:s,showReview:r=!1,size:n="md",readOnly:i=!1,className:o}){let{user:l}=(0,Q.useAuth)(),{userRating:c,averageRating:d,totalRatings:u,submitRating:m,isSubmitting:f}=Z(e,s),[p,h]=(0,a.useState)(0),[x,g]=(0,a.useState)(c?.rating||0),[y,v]=(0,a.useState)(c?.review||""),[w,b]=(0,a.useState)(!1),j={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"},N=i?d:p||x||c?.rating||0;return(0,t.jsxs)("div",{className:(0,C.cn)("flex flex-col gap-2",o),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(e=>(0,t.jsx)("button",{type:"button",disabled:i,onClick:()=>(e=>{if(!i){if(!l)return void $.toast.error("Silakan login terlebih dahulu");g(e),r?b(!0):m({rating:e},{onSuccess:()=>$.toast.success("Rating berhasil disimpan"),onError:()=>$.toast.error("Gagal menyimpan rating")})}})(e),onMouseEnter:()=>!i&&h(e),onMouseLeave:()=>!i&&h(0),className:(0,C.cn)("transition-transform",!i&&"hover:scale-110 cursor-pointer"),children:(0,t.jsx)(H.Star,{className:(0,C.cn)(j[n],"transition-colors",e<=N?"fill-yellow-400 text-yellow-400":"text-gray-400")})},e))}),i&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[d.toFixed(1)," (",u," ulasan)"]})]}),r&&w&&(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,t.jsx)(z,{placeholder:"Tulis ulasan Anda (opsional)...",value:y,onChange:e=>v(e.target.value),rows:3}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(F.Button,{onClick:()=>{x?m({rating:x,review:y||void 0},{onSuccess:()=>{$.toast.success("Ulasan berhasil disimpan"),b(!1)},onError:()=>$.toast.error("Gagal menyimpan ulasan")}):$.toast.error("Pilih rating terlebih dahulu")},disabled:f,size:"sm",children:f?"Menyimpan...":"Simpan Ulasan"}),(0,t.jsx)(F.Button,{variant:"outline",onClick:()=>b(!1),size:"sm",children:"Batal"})]})]})]})}e.s(["RatingStars",()=>X],57974);let Y=(0,R.default)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);var ee=e.i(27612);let et=(0,R.default)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var ea=e.i(31278),es=e.i(30207),er=e.i(34620);e.i(74080);var en=e.i(91918),ei=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let r=(0,en.createSlot)(`Primitive.${s}`),n=a.forwardRef((e,a)=>{let{asChild:n,...i}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(n?r:s,{...i,ref:a})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{}),eo=e.i(2239);function el(){return()=>{}}var ec="Avatar",[ed,eu]=function(e,s=[]){let r=[],n=()=>{let t=r.map(e=>a.createContext(e));return function(s){let r=s?.[e]||t;return a.useMemo(()=>({[`__scope${e}`]:{...s,[e]:r}}),[s,r])}};return n.scopeName=e,[function(s,n){let i=a.createContext(n);i.displayName=s+"Context";let o=r.length;r=[...r,n];let l=s=>{let{scope:r,children:n,...l}=s,c=r?.[e]?.[o]||i,d=a.useMemo(()=>l,Object.values(l));return(0,t.jsx)(c.Provider,{value:d,children:n})};return l.displayName=s+"Provider",[l,function(t,r){let l=r?.[e]?.[o]||i,c=a.useContext(l);if(c)return c;if(void 0!==n)return n;throw Error(`\`${t}\` must be used within \`${s}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let s=()=>{let s=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=s.reduce((t,{useScope:a,scopeName:s})=>{let r=a(e)[`__scope${s}`];return{...t,...r}},{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return s.scopeName=t.scopeName,s}(n,...s)]}(ec),[em,ef]=ed(ec),ep=a.forwardRef((e,s)=>{let{__scopeAvatar:r,...n}=e,[i,o]=a.useState("idle");return(0,t.jsx)(em,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:(0,t.jsx)(ei.span,{...n,ref:s})})});ep.displayName=ec;var eh="AvatarImage",ex=a.forwardRef((e,s)=>{let{__scopeAvatar:r,src:n,onLoadingStatusChange:i=()=>{},...o}=e,l=ef(eh,r),c=function(e,{referrerPolicy:t,crossOrigin:s}){let r=(0,eo.useSyncExternalStore)(el,()=>!0,()=>!1),n=a.useRef(null),i=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=a.useState(()=>ev(i,e));return(0,er.useLayoutEffect)(()=>{l(ev(i,e))},[i,e]),(0,er.useLayoutEffect)(()=>{let e=e=>()=>{l(e)};if(!i)return;let a=e("loaded"),r=e("error");return i.addEventListener("load",a),i.addEventListener("error",r),t&&(i.referrerPolicy=t),"string"==typeof s&&(i.crossOrigin=s),()=>{i.removeEventListener("load",a),i.removeEventListener("error",r)}},[i,s,t]),o}(n,o),d=(0,es.useCallbackRef)(e=>{i(e),l.onImageLoadingStatusChange(e)});return(0,er.useLayoutEffect)(()=>{"idle"!==c&&d(c)},[c,d]),"loaded"===c?(0,t.jsx)(ei.img,{...o,ref:s,src:n}):null});ex.displayName=eh;var eg="AvatarFallback",ey=a.forwardRef((e,s)=>{let{__scopeAvatar:r,delayMs:n,...i}=e,o=ef(eg,r),[l,c]=a.useState(void 0===n);return a.useEffect(()=>{if(void 0!==n){let e=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(e)}},[n]),l&&"loaded"!==o.imageLoadingStatus?(0,t.jsx)(ei.span,{...i,ref:s}):null});function ev(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ey.displayName=eg;let ew=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(ep,{ref:s,className:(0,C.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...a}));ew.displayName=ep.displayName,a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(ex,{ref:s,className:(0,C.cn)("aspect-square h-full w-full",e),...a})).displayName=ex.displayName;let eb=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(ey,{ref:s,className:(0,C.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...a}));eb.displayName=ey.displayName;var ej=e.i(9637),eN=e.i(88680);function ek({comment:e,onReply:a,onDelete:s,onLike:r,currentUserId:n}){let i=n===e.user_id;return(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(ew,{className:"w-8 h-8",children:(0,t.jsx)(eb,{className:"text-xs",children:e.user_email?.charAt(0).toUpperCase()||"U"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e.user_email?.split("@")[0]||"Pengguna"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,ej.formatDistanceToNow)(new Date(e.created_at),{addSuffix:!0,locale:eN.id})})]}),(0,t.jsx)("p",{className:"text-sm text-foreground mb-2",children:e.content}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("button",{onClick:()=>r(e.id),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors",children:[(0,t.jsx)(Y,{className:(0,C.cn)("w-3.5 h-3.5",e.is_liked&&"fill-primary text-primary")}),(0,t.jsx)("span",{children:e.likes_count})]}),(0,t.jsxs)("button",{onClick:()=>a(e.id),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors",children:[(0,t.jsx)(et,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Balas"})]}),i&&(0,t.jsx)("button",{onClick:()=>s(e.id),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-destructive transition-colors",children:(0,t.jsx)(ee.Trash2,{className:"w-3.5 h-3.5"})})]}),e.replies&&e.replies.length>0&&(0,t.jsx)("div",{className:"mt-3 pl-4 border-l-2 border-muted space-y-3",children:e.replies.map(e=>(0,t.jsx)(ek,{comment:e,onReply:a,onDelete:s,onLike:r,currentUserId:n},e.id))})]})]})}function eS({drama_id:e,platform:s,episode_id:r,className:n}){let{user:i}=(0,Q.useAuth)(),{comments:o,isLoading:l,addComment:c,deleteComment:d,likeComment:u,isSubmitting:m}=function(e,t,a){let{user:s}=(0,Q.useAuth)(),r=(0,J.useQueryClient)(),n=(0,O.useQuery)({queryKey:["comments",e,t,a],queryFn:async()=>{if(!e||!t)return[];let s=W.supabase.from("comments").select("*").eq("drama_id",e).eq("platform",t).is("parent_id",null).order("created_at",{ascending:!1});a&&(s=s.eq("episode_id",a));let{data:r,error:n}=await s;if(n)throw n;if(r.length>0){let{data:a}=await W.supabase.from("comments").select("*").eq("drama_id",e).eq("platform",t).not("parent_id","is",null).order("created_at",{ascending:!0}),s=new Map;(a||[]).forEach(e=>{if(e.parent_id){let t=s.get(e.parent_id)||[];t.push(e),s.set(e.parent_id,t)}}),r.forEach(e=>{e.replies=s.get(e.id)||[]})}return r},enabled:!!e&&!!t}),i=(0,V.useMutation)({mutationFn:async r=>{if(!s||!e||!t)throw Error("Missing required data");let{error:n}=await W.supabase.from("comments").insert({user_id:s.id,drama_id:e,platform:t,episode_id:a,content:r.content,parent_id:r.parent_id||null});if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["comments",e,t,a]})}}),o=(0,V.useMutation)({mutationFn:async e=>{if(!s)throw Error("Must be logged in");let{error:t}=await W.supabase.from("comments").delete().eq("id",e).eq("user_id",s.id);if(t)throw t},onSuccess:()=>{r.invalidateQueries({queryKey:["comments",e,t,a]})}}),l=(0,V.useMutation)({mutationFn:async e=>{if(!s)throw Error("Must be logged in");let{error:t}=await W.supabase.from("comment_likes").insert({user_id:s.id,comment_id:e});if(t&&"23505"!==t.code)throw t;await W.supabase.rpc("increment_comment_likes",{comment_id:e})},onSuccess:()=>{r.invalidateQueries({queryKey:["comments",e,t,a]})}}),c=(0,V.useMutation)({mutationFn:async e=>{if(!s)throw Error("Must be logged in");let{error:t}=await W.supabase.from("comment_likes").delete().eq("user_id",s.id).eq("comment_id",e);if(t)throw t;await W.supabase.rpc("decrement_comment_likes",{comment_id:e})},onSuccess:()=>{r.invalidateQueries({queryKey:["comments",e,t,a]})}});return{comments:n.data??[],isLoading:n.isLoading,addComment:i.mutate,deleteComment:o.mutate,likeComment:l.mutate,unlikeComment:c.mutate,isSubmitting:i.isPending}}(e,s,r),[f,p]=(0,a.useState)(""),[h,x]=(0,a.useState)(null),g=e=>{confirm("Hapus komentar ini?")&&d(e,{onSuccess:()=>$.toast.success("Komentar dihapus"),onError:()=>$.toast.error("Gagal menghapus komentar")})},y=e=>{i?u(e):$.toast.error("Silakan login terlebih dahulu")};return(0,t.jsxs)("div",{className:(0,C.cn)("space-y-4",n),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(I,{className:"w-5 h-5"}),(0,t.jsxs)("h3",{className:"font-semibold",children:["Komentar (",o.length,")"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[h&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)("span",{children:"Membalas komentar"}),(0,t.jsx)("button",{onClick:()=>x(null),className:"text-primary hover:underline",children:"Batal"})]}),(0,t.jsx)(z,{placeholder:i?"Tulis komentar...":"Login untuk berkomentar",value:f,onChange:e=>p(e.target.value),disabled:!i,rows:2}),(0,t.jsxs)(F.Button,{onClick:()=>{i?f.trim()?c({content:f,parent_id:h||void 0},{onSuccess:()=>{p(""),x(null),$.toast.success("Komentar berhasil ditambahkan")},onError:()=>$.toast.error("Gagal menambahkan komentar")}):$.toast.error("Komentar tidak boleh kosong"):$.toast.error("Silakan login terlebih dahulu")},disabled:!i||m||!f.trim(),className:"self-end",children:[m?(0,t.jsx)(ea.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Kirim"]})]}),l?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(ea.Loader2,{className:"w-6 h-6 animate-spin"})}):0===o.length?(0,t.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Belum ada komentar. Jadilah yang pertama!"}):(0,t.jsx)("div",{className:"space-y-4",children:o.map(e=>(0,t.jsx)(ek,{comment:e,onReply:x,onDelete:g,onLike:y,currentUserId:i?.id},e.id))})]})}function eC({drama_id:e,platform:a,className:s}){let{ratings:r,averageRating:n,totalRatings:i,isLoading:o}=Z(e,a),l=r.filter(e=>e.review);return(0,t.jsxs)("div",{className:(0,C.cn)("space-y-4",s),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H.Star,{className:"w-5 h-5 fill-yellow-400 text-yellow-400"}),(0,t.jsx)("h3",{className:"font-semibold",children:"Ulasan"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(H.Star,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),(0,t.jsx)("span",{className:"font-medium text-foreground",children:n.toFixed(1)})]}),(0,t.jsxs)("span",{children:["(",i," rating)"]})]})]}),o?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(ea.Loader2,{className:"w-6 h-6 animate-spin"})}):0===l.length?(0,t.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Belum ada ulasan. Jadilah yang pertama!"}):(0,t.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,t.jsxs)("div",{className:"flex gap-3 p-3 rounded-lg bg-muted/30",children:[(0,t.jsx)(ew,{className:"w-10 h-10",children:(0,t.jsx)(eb,{children:e.user_email?.charAt(0).toUpperCase()||"U"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:e.user_email?.split("@")[0]||"Pengguna"}),(0,t.jsx)("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(a=>(0,t.jsx)(H.Star,{className:(0,C.cn)("w-3.5 h-3.5",a<=e.rating?"fill-yellow-400 text-yellow-400":"text-gray-400")},a))}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,ej.formatDistanceToNow)(new Date(e.created_at),{addSuffix:!0,locale:eN.id})})]}),(0,t.jsx)("p",{className:"text-sm",children:e.review})]})]},e.id))})]})}e.s(["CommentsSection",()=>eS],81464),e.s(["ReviewsList",()=>eC],26120)}]);