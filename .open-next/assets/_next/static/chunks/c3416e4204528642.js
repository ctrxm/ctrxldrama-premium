(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73375,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],73375)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},63209,e=>{"use strict";let t=(0,e.i(75254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},70956,e=>{"use strict";let t=(0,e.i(75254).default)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);e.s(["List",()=>t],70956)},39616,e=>{"use strict";let t=(0,e.i(75254).default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>t],39616)},95242,e=>{"use strict";let t=(0,e.i(75254).default)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);e.s(["Pause",()=>t],95242)},36120,e=>{"use strict";var t=e.i(43476),s=e.i(71645),l=e.i(66027),i=e.i(31278),a=e.i(63209),r=e.i(37727),o=e.i(18566),n=e.i(73375),c=e.i(39616),d=e.i(70956),u=e.i(31343),h=e.i(95242),m=e.i(22016),p=e.i(50471),x=e.i(55146);function f({bookId:e,initialEpisode:l,totalEpisodes:i,title:a,episodes:r,onEpisodeChange:o,onShowEpisodeList:f}){let[y,b]=(0,s.useState)(l),[k,g]=(0,s.useState)(!0),[j,v]=(0,s.useState)(0),[w,N]=(0,s.useState)("auto"),[C,L]=(0,s.useState)(0),[S,q]=(0,s.useState)(0),[E,M]=(0,s.useState)(!1),T=(0,s.useRef)(null),$=(0,s.useRef)(null),z=(0,s.useRef)(null),A=r.find(e=>e.episodeNumber===y),P=A?.videoList.map((e,t)=>{let s="";return s=0===e.quality?`1080p (${e.encode})`:`${e.quality}p (${e.encode})`,{id:`${e.encode}-${e.quality}-${t}`,label:s,quality:0===e.quality?1080:e.quality,video:e}}).sort((e,t)=>t.quality-e.quality)||[],D=(0,s.useCallback)(()=>{if(!A?.videoList?.length)return null;if("auto"===w||!P.length)return A.videoList.find(e=>"H264"===e.encode)||A.videoList[0];let e=P.find(e=>e.id===w);return e?.video||A.videoList[0]},[A,w,P]),I=(0,s.useCallback)(e=>{if(!T.current)return;let t=T.current;if(p.default.isSupported()){$.current&&$.current.destroy();let s=new p.default({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90});$.current=s,s.loadSource(e),s.attachMedia(t),s.on(p.default.Events.MANIFEST_PARSED,()=>{t.play().catch(()=>{})})}else t.canPlayType("application/vnd.apple.mpegurl")&&(t.src=e,t.play().catch(()=>{}))},[]);(0,s.useEffect)(()=>{let e=D();if(e&&T.current)return I(e.url),()=>{$.current&&($.current.destroy(),$.current=null)}},[y,w,D,I]);let R=(0,s.useCallback)(()=>{if(!T.current)return;let e=T.current;v(e.currentTime/e.duration*100)},[]),F=(0,s.useCallback)(()=>{if(y<i){let e=y+1;b(e),o(e),v(0)}},[y,i,o]),K=(0,s.useCallback)(()=>{T.current&&(T.current.paused?(T.current.play(),g(!0)):(T.current.pause(),g(!1)))},[]);return(0,s.useEffect)(()=>{let e=e=>{if("ArrowUp"===e.key&&y>1&&!E){let e=y-1;b(e),o(e),v(0)}else if("ArrowDown"===e.key&&y<i&&!E){let e=y+1;b(e),o(e),v(0)}else" "===e.key&&(e.preventDefault(),K())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y,i,E,o,K]),(0,t.jsxs)("div",{ref:z,className:"tiktok-player-container",onTouchStart:e=>{L(e.targetTouches[0].clientY)},onTouchMove:e=>{q(e.targetTouches[0].clientY)},onTouchEnd:()=>{if(!C||!S||E)return;let e=C-S;if(!(50>Math.abs(e))){if(M(!0),e>0&&y<i){let e=y+1;b(e),o(e),v(0)}if(e<0&&y>1){let e=y-1;b(e),o(e),v(0)}setTimeout(()=>M(!1),300),L(0),q(0)}},children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0 z-40 safe-top",children:(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/80 to-transparent",children:[(0,t.jsx)(m.default,{href:`/detail/reelshort/${e}`,className:"flex items-center gap-2 text-white/90 hover:text-white transition-colors",children:(0,t.jsx)(n.ChevronLeft,{className:"w-6 h-6"})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"tiktok-control-btn w-10 h-10",children:(0,t.jsx)(c.Settings,{className:"w-5 h-5"})})}),(0,t.jsxs)(x.DropdownMenuContent,{align:"end",className:"z-[100]",children:[(0,t.jsx)(x.DropdownMenuItem,{onClick:()=>N("auto"),className:"auto"===w?"text-primary font-semibold":"",children:"Auto (H264)"}),P.map(e=>(0,t.jsx)(x.DropdownMenuItem,{onClick:()=>N(e.id),className:w===e.id?"text-primary font-semibold":"",children:e.label},e.id))]})]}),(0,t.jsx)("button",{onClick:f,className:"tiktok-control-btn w-10 h-10",children:(0,t.jsx)(d.List,{className:"w-5 h-5"})})]})]})}),(0,t.jsxs)("div",{className:"tiktok-video-wrapper",children:[(0,t.jsx)("video",{ref:T,className:"tiktok-video",playsInline:!0,autoPlay:!0,onTimeUpdate:R,onEnded:F,onClick:K}),!k&&(0,t.jsx)("button",{onClick:K,className:"absolute inset-0 flex items-center justify-center z-20",children:(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:(0,t.jsx)(u.Play,{className:"w-10 h-10 text-white ml-1"})})})]}),(0,t.jsxs)("div",{className:"tiktok-info safe-bottom",children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-1 drop-shadow-lg",children:a}),(0,t.jsxs)("p",{className:"text-sm text-white/80 drop-shadow-lg",children:["Episode ",y," of ",i]})]}),(0,t.jsx)("div",{className:"tiktok-controls safe-bottom",children:(0,t.jsx)("button",{onClick:K,className:"tiktok-control-btn",children:k?(0,t.jsx)(h.Pause,{className:"w-6 h-6"}):(0,t.jsx)(u.Play,{className:"w-6 h-6 ml-1"})})}),(0,t.jsx)("div",{className:"tiktok-progress",children:(0,t.jsx)("div",{className:"tiktok-progress-bar",style:{width:`${j}%`}})}),y>1&&(0,t.jsx)("div",{className:"swipe-indicator top",children:"↑ Swipe up for previous episode"}),y<i&&(0,t.jsx)("div",{className:"swipe-indicator bottom",children:"↓ Swipe down for next episode"})]})}var y=e.i(73652);async function b(e,t){return(0,y.fetchJson)(`/api/reelshort/watch?bookId=${e}&episodeNumber=${t}`)}async function k(e){return(0,y.fetchJson)(`/api/reelshort/detail?bookId=${e}`)}function g(){let e=(0,o.useParams)(),n=(0,o.useSearchParams)(),c=(0,o.useRouter)(),d=e.bookId,[u,h]=(0,s.useState)(1),[m,p]=(0,s.useState)(!1),[x,y]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e=n.get("ep");e&&h(parseInt(e)||1)},[n]);let{data:g}=(0,l.useQuery)({queryKey:["reelshort","detail",d],queryFn:()=>k(d||""),enabled:!!d}),{data:j,isLoading:v,error:w}=(0,l.useQuery)({queryKey:["reelshort","episode",d,u],queryFn:()=>b(d||"",u),enabled:!!d&&u>0});(0,l.useQuery)({queryKey:["reelshort","episode",d,u+1],queryFn:()=>b(d||"",u+1),enabled:!!d&&u<(g?.totalEpisodes||0)}),(0,s.useEffect)(()=>{j&&!j.isLocked&&y(e=>e.find(e=>e.episodeNumber===u)?e:[...e,{episodeNumber:u,videoList:j.videoList,isLocked:j.isLocked}])},[j,u]);let N=g?.totalEpisodes||1;return v&&0===x.length?(0,t.jsx)("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:(0,t.jsx)(i.Loader2,{className:"w-12 h-12 text-primary animate-spin"})}):w?(0,t.jsxs)("div",{className:"fixed inset-0 bg-black flex flex-col items-center justify-center text-center p-4",children:[(0,t.jsx)(a.AlertCircle,{className:"w-12 h-12 text-destructive mb-4"}),(0,t.jsx)("p",{className:"text-white text-lg mb-4",children:"Failed to load video"}),(0,t.jsx)("button",{onClick:()=>c.refresh(),className:"px-6 py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors",children:"Try Again"})]}):j?.isLocked?(0,t.jsxs)("div",{className:"fixed inset-0 bg-black flex flex-col items-center justify-center text-center p-4",children:[(0,t.jsx)(a.AlertCircle,{className:"w-12 h-12 text-yellow-500 mb-4"}),(0,t.jsx)("p",{className:"text-white text-lg font-medium mb-4",children:"This episode is locked"}),(0,t.jsx)("button",{onClick:()=>c.push(`/detail/reelshort/${d}`),className:"px-6 py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors",children:"Back to Details"})]}):(0,t.jsxs)(t.Fragment,{children:[x.length>0&&g&&(0,t.jsx)(f,{bookId:d,initialEpisode:u,totalEpisodes:N,title:g.title,episodes:x,onEpisodeChange:e=>{h(e),c.replace(`/watch/reelshort/${d}?ep=${e}`,{scroll:!1})},onShowEpisodeList:()=>p(!0)}),m&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-card w-full sm:max-w-2xl sm:rounded-t-2xl rounded-t-2xl max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:"Episodes"}),(0,t.jsx)("button",{onClick:()=>p(!1),className:"p-2 hover:bg-secondary rounded-lg transition-colors",children:(0,t.jsx)(r.X,{className:"w-5 h-5"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3",children:Array.from({length:N},(e,t)=>t+1).map(e=>(0,t.jsx)("button",{onClick:()=>{h(e),c.replace(`/watch/reelshort/${d}?ep=${e}`,{scroll:!1}),p(!1)},className:`
                      aspect-square rounded-lg font-semibold text-sm transition-all
                      ${e===u?"bg-primary text-white":"bg-secondary hover:bg-secondary/80 text-foreground"}
                    `,children:e},e))})})]})})]})}e.s(["default",()=>g],36120)}]);