(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},68148,46695,e=>{"use strict";var t=e.i(43476),a=e.i(71645);e.i(74080);var r=e.i(91918),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let i=(0,r.createSlot)(`Primitive.${s}`),o=a.forwardRef((e,a)=>{let{asChild:r,...o}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(r?i:s,{...o,ref:a})});return o.displayName=`Primitive.${s}`,{...e,[s]:o}},{}),i="Progress",[o,n]=function(e,r=[]){let s=[],i=()=>{let t=s.map(e=>a.createContext(e));return function(r){let s=r?.[e]||t;return a.useMemo(()=>({[`__scope${e}`]:{...r,[e]:s}}),[r,s])}};return i.scopeName=e,[function(r,i){let o=a.createContext(i);o.displayName=r+"Context";let n=s.length;s=[...s,i];let l=r=>{let{scope:s,children:i,...l}=r,d=s?.[e]?.[n]||o,u=a.useMemo(()=>l,Object.values(l));return(0,t.jsx)(d.Provider,{value:u,children:i})};return l.displayName=r+"Provider",[l,function(t,s){let l=s?.[e]?.[n]||o,d=a.useContext(l);if(d)return d;if(void 0!==i)return i;throw Error(`\`${t}\` must be used within \`${r}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=r.reduce((t,{useScope:a,scopeName:r})=>{let s=a(e)[`__scope${r}`];return{...t,...s}},{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return r.scopeName=t.scopeName,r}(i,...r)]}(i),[l,d]=o(i),u=a.forwardRef((e,a)=>{var r,i;let{__scopeProgress:o,value:n=null,max:d,getValueLabel:u=h,...c}=e;(d||0===d)&&!x(d)&&console.error((r=`${d}`,`Invalid prop \`max\` of value \`${r}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let m=x(d)?d:100;null===n||y(n,m)||console.error((i=`${n}`,`Invalid prop \`value\` of value \`${i}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let v=y(n,m)?n:null,w=p(v)?u(v,m):void 0;return(0,t.jsx)(l,{scope:o,value:v,max:m,children:(0,t.jsx)(s.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":p(v)?v:void 0,"aria-valuetext":w,role:"progressbar","data-state":f(v,m),"data-value":v??void 0,"data-max":m,...c,ref:a})})});u.displayName=i;var c="ProgressIndicator",m=a.forwardRef((e,a)=>{let{__scopeProgress:r,...i}=e,o=d(c,r);return(0,t.jsx)(s.div,{"data-state":f(o.value,o.max),"data-value":o.value??void 0,"data-max":o.max,...i,ref:a})});function h(e,t){return`${Math.round(e/t*100)}%`}function f(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function p(e){return"number"==typeof e}function x(e){return p(e)&&!isNaN(e)&&e>0}function y(e,t){return p(e)&&!isNaN(e)&&e<=t&&e>=0}m.displayName=c;var v=e.i(75157);let w=a.forwardRef(({className:e,value:a,...r},s)=>(0,t.jsx)(u,{ref:s,className:(0,v.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:(0,t.jsx)(m,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));w.displayName=u.displayName,e.s(["Progress",()=>w],68148);var _=e.i(66027),g=e.i(54616),j=e.i(12598),N=e.i(7471),b=e.i(57951);function $(){let{user:e}=(0,b.useAuth)(),t=(0,j.useQueryClient)(),a=(0,_.useQuery)({queryKey:["watch_history",e?.id],queryFn:async()=>{if(!e)return[];let{data:t,error:a}=await N.supabase.from("watch_history").select("*").eq("user_id",e.id).order("last_watched_at",{ascending:!1}).limit(50);if(a)throw a;return t},enabled:!!e}),r=(0,g.useMutation)({mutationFn:async t=>{if(!e)throw Error("Must be logged in");let{error:a}=await N.supabase.from("watch_history").upsert({user_id:e.id,drama_id:t.drama_id,platform:t.platform,drama_title:t.drama_title,drama_cover:t.drama_cover,episode_id:t.episode_id,episode_number:t.episode_number??1,watch_position:t.watch_position??0,duration:t.duration??0,last_watched_at:new Date().toISOString()},{onConflict:"user_id,drama_id,platform,episode_id"});if(a)throw a},onSuccess:()=>{t.invalidateQueries({queryKey:["watch_history",e?.id]})}}),s=(0,g.useMutation)({mutationFn:async()=>{if(!e)throw Error("Must be logged in");let{error:t}=await N.supabase.from("watch_history").delete().eq("user_id",e.id);if(t)throw t},onSuccess:()=>{t.invalidateQueries({queryKey:["watch_history",e?.id]})}}),i=(0,g.useMutation)({mutationFn:async t=>{if(!e)throw Error("Must be logged in");let{error:a}=await N.supabase.from("watch_history").delete().eq("user_id",e.id).eq("drama_id",t.drama_id).eq("platform",t.platform);if(a)throw a},onSuccess:()=>{t.invalidateQueries({queryKey:["watch_history",e?.id]})}});return{history:a.data??[],isLoading:a.isLoading,updateHistory:r.mutate,clearHistory:s.mutate,removeFromHistory:i.mutate,getResumePosition:(e,t,r)=>{let s=a.data?.find(a=>a.drama_id===e&&a.platform===t&&(!r||a.episode_id===r));return s?{position:s.watch_position,episode:s.episode_number}:null},getRecentlyWatched:(e=10)=>{let t=new Map;return a.data?.forEach(e=>{let a=`${e.drama_id}-${e.platform}`;(!t.has(a)||new Date(e.last_watched_at)>new Date(t.get(a).last_watched_at))&&t.set(a,e)}),Array.from(t.values()).slice(0,e)}}}e.s(["useWatchHistory",()=>$],46695)},77582,e=>{"use strict";var t=e.i(43476),a=e.i(2971),r=e.i(84276),s=e.i(27516),i=e.i(31343),o=e.i(27612),n=e.i(37727),l=e.i(19455),d=e.i(68148),u=e.i(59684),c=e.i(46695),m=e.i(57951),h=e.i(75157),f=e.i(9637),p=e.i(88680),x=e.i(57688),y=e.i(22016),v=e.i(46696);function w({limit:e,showClearAll:a=!0,className:r}){let{user:w}=(0,m.useAuth)(),{getRecentlyWatched:_,clearHistory:g,removeFromHistory:j,isLoading:N}=(0,c.useWatchHistory)(),b=_(e||20);return w?N?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("span",{className:"text-muted-foreground",children:"Memuat..."})}):0===b.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,t.jsx)(s.History,{className:"w-12 h-12 mb-3 opacity-50"}),(0,t.jsx)("p",{className:"text-center",children:"Belum ada riwayat tontonan"})]}):(0,t.jsxs)("div",{className:(0,h.cn)("space-y-4",r),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.History,{className:"w-5 h-5"}),(0,t.jsx)("h3",{className:"font-semibold",children:"Riwayat Tontonan"})]}),a&&b.length>0&&(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>{confirm("Hapus semua riwayat tontonan?")&&g(void 0,{onSuccess:()=>v.toast.success("Riwayat dihapus"),onError:()=>v.toast.error("Gagal menghapus riwayat")})},children:[(0,t.jsx)(o.Trash2,{className:"w-4 h-4 mr-1"}),"Hapus Semua"]})]}),(0,t.jsx)(u.ScrollArea,{className:"max-h-[400px]",children:(0,t.jsx)("div",{className:"space-y-3",children:b.map(e=>{let a=e.duration>0?e.watch_position/e.duration*100:0;return(0,t.jsxs)("div",{className:"flex gap-3 p-2 rounded-lg hover:bg-muted/50 transition-colors group",children:[(0,t.jsxs)(y.default,{href:`/drama/${e.platform}/${e.drama_id}`,className:"relative w-24 h-14 rounded overflow-hidden flex-shrink-0",children:[e.drama_cover?(0,t.jsx)(x.default,{src:e.drama_cover,alt:e.drama_title,fill:!0,className:"object-cover"}):(0,t.jsx)("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:(0,t.jsx)(i.Play,{className:"w-6 h-6 text-muted-foreground"})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(i.Play,{className:"w-6 h-6 text-white"})})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(y.default,{href:`/drama/${e.platform}/${e.drama_id}`,className:"text-sm font-medium line-clamp-1 hover:text-primary",children:e.drama_title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Episode ",e.episode_number]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(d.Progress,{value:a,className:"h-1 flex-1"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[Math.round(a),"%"]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:(0,f.formatDistanceToNow)(new Date(e.last_watched_at),{addSuffix:!0,locale:p.id})})]}),(0,t.jsx)("button",{onClick:()=>{j({drama_id:e.drama_id,platform:e.platform},{onSuccess:()=>v.toast.success("Dihapus dari riwayat"),onError:()=>v.toast.error("Gagal menghapus")})},className:"p-1 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive",children:(0,t.jsx)(n.X,{className:"w-4 h-4"})})]},`${e.drama_id}-${e.platform}`)})})})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,t.jsx)(s.History,{className:"w-12 h-12 mb-3 opacity-50"}),(0,t.jsx)("p",{className:"text-center",children:"Login untuk melihat riwayat tontonan"})]})}function _(){return(0,t.jsxs)("main",{className:"min-h-screen pb-20",children:[(0,t.jsx)(a.Header,{}),(0,t.jsxs)("div",{className:"container mx-auto px-4 pt-20",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Riwayat Tontonan"}),(0,t.jsx)(w,{})]}),(0,t.jsx)(r.BottomNav,{})]})}e.s(["default",()=>_],77582)}]);